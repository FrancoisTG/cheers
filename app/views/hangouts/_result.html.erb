<h1>Result</h1>


<h1><%= @hangout.place.name %></h1>
<div id="direction_map" style="width: 100%; height: 300px;"></div>

<%=@transport%>
<%="Lat: #{@direction[:lat]} + Long: #{@direction[:lng]}"%>
<%="Lat: #{@departure[:lat]} + Long: #{@departure[:lng]}"%>

<% content_for(:after_js) do %>
  <%= javascript_tag do %>
    $(document).ready(function() {
      var departure = (<%= raw @departure.to_json %>);
      var direction = (<%= raw @direction.to_json %>);
      var selectedMode = (<%= raw @transport.to_json %>);

      var d = new Date("May 3, 2017 20:13:00");

      var totalDistance = 0;
      var totalDuration = 0;

      console.log(selectedMode)

      initMap();

      function initMap() {
        var directionsDisplay = new google.maps.DirectionsRenderer({suppressMarkers : true});
        var directionsService = new google.maps.DirectionsService;
      console.log(directionsService)
        var map = new google.maps.Map(document.getElementById('direction_map'), window.MAP_OPTIONS);
        directionsDisplay.setMap(map);

        calculateAndDisplayRoute(directionsService, directionsDisplay);
      }

      function calculateAndDisplayRoute(directionsService, directionsDisplay) {

        directionsService.route({
          origin: {lat: departure.lat, lng: departure.lng},
          destination: {lat: direction.lat, lng: direction.lng},
          travelMode: google.maps.TravelMode[selectedMode],
          unitSystem: google.maps.UnitSystem.METRIC,
          drivingOptions: {
            departureTime: d
          },
        }, function(response, status) {
          if (status == 'OK') {
            directionsDisplay.setDirections(response);
            var legs = response.routes[0].legs;
            for(var i=0; i<legs.length; ++i) {
                totalDistance += legs[i].distance.value;
                console.log(totalDistance);
                totalDuration += legs[i].duration.value;
            }
            console.log(totalDistance);
            console.log(totalDuration);
          } else {
            window.alert('Directions request failed due to ' + status);
          }
        });
      }
    });
  <% end %>
<% end %>
